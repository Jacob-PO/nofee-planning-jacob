<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deal 페이지 가격 API 개선 - 노피 어드민 시스템</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://jacob-po.github.io/nofee-planning-jacob/docs/plan_2025-12-13_Deal페이지_가격API_개선_v1.0.html">
    <meta property="og:title" content="[노피 기획안] Deal 페이지 가격 API 개선">
    <meta property="og:description" content="외부 API 의존성 제거 - Deal 페이지 가격 구성 섹션 안정화 | 스케줄러 기반 데이터 수집 | 작성: 제이콥 | v1.0">
    <meta property="og:image" content="https://nofee.team/images/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="노피 기획안 - Deal 페이지 가격 API 개선">
    <meta property="og:site_name" content="노피 NOFEE - 기획 문서">
    <meta property="og:locale" content="ko_KR">
    <meta property="article:author" content="제이콥">
    <meta property="article:published_time" content="2025-12-13T00:00:00+09:00">
    <meta property="article:modified_time" content="2025-12-13T00:00:00+09:00">
    <meta property="article:section" content="기획안">
    <meta property="article:tag" content="API">
    <meta property="article:tag" content="Deal페이지">
    <meta property="article:tag" content="가격정보">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://jacob-po.github.io/nofee-planning-jacob/docs/plan_2025-12-13_Deal페이지_가격API_개선_v1.0.html">
    <meta name="twitter:title" content="[노피 기획안] Deal 페이지 가격 API 개선">
    <meta name="twitter:description" content="외부 API 의존성 제거 - Deal 페이지 가격 구성 섹션 안정화">
    <meta name="twitter:image" content="https://nofee.team/images/og-image.png">
    <meta name="twitter:image:alt" content="노피 기획안 - Deal 페이지 가격 API 개선">
    <meta name="twitter:creator" content="@nofee_team">

    <!-- Meta Description -->
    <meta name="description" content="외부 API 의존성 제거 - Deal 페이지 가격 구성 섹션 안정화 | 스케줄러 기반 데이터 수집 | 노피 기획안 v1.0">
    <meta name="keywords" content="노피, NOFEE, 기획안, API, Deal페이지, 가격정보, 공시지원금">

    <link href="https://cdn.jsdelivr.net/gh/sun-typeface/SUIT@2/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @media print {
            @page {
                size: A4;
                margin: 0;
            }
            body {
                padding: 15mm;
            }
        }

        body {
            font-family: 'SUIT Variable', -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', 'Pretendard', 'Malgun Gothic', sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            background: #ffffff;
            color: #191f28;
            line-height: 1.6;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
        }

        .document-header {
            border-bottom: 2px solid #3182f6;
            padding-bottom: 24px;
            margin-bottom: 32px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .logo {
            height: 32px;
        }

        .doc-meta {
            text-align: right;
            font-size: 11px;
            color: #8b95a1;
        }

        .doc-meta-item {
            margin-bottom: 4px;
        }

        .doc-title {
            font-size: 28px;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .doc-subtitle {
            font-size: 16px;
            color: #4e5968;
            font-weight: 400;
        }

        .info-box {
            background: #f9fafb;
            border: 1px solid #e5e8eb;
            border-radius: 12px;
            padding: 20px;
            margin: 24px 0;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
        }

        .info-item {
        }

        .info-label {
            font-size: 12px;
            color: #8b95a1;
            margin-bottom: 8px;
        }

        .info-value {
            font-size: 16px;
            color: #191f28;
            font-weight: 600;
        }

        .section {
            margin: 40px 0;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #191f28;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e8eb;
        }

        .subsection-title {
            font-size: 16px;
            font-weight: 600;
            color: #191f28;
            margin: 24px 0 12px 0;
        }

        .content {
            color: #4e5968;
            line-height: 1.8;
        }

        .content p {
            margin-bottom: 12px;
        }

        .content ul, .content ol {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .content li {
            margin-bottom: 8px;
        }

        .highlight-box {
            background: #eff8ff;
            border-left: 4px solid #3182f6;
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 4px;
        }

        .highlight-box strong {
            color: #191f28;
        }

        .highlight-box.warning {
            background: #fff7ed;
            border-left-color: #f59e0b;
        }

        .highlight-box.success {
            background: #ecfdf5;
            border-left-color: #10b981;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e5e8eb;
        }

        .comparison-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #191f28;
        }

        .comparison-table td {
            color: #4e5968;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
        }

        .tag-before {
            background: #fee;
            color: #d32f2f;
        }

        .tag-after {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .flow-diagram {
            background: #f9fafb;
            border: 1px solid #e5e8eb;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
            text-align: center;
        }

        .flow-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 12px 0;
            flex-wrap: wrap;
        }

        .flow-box {
            background: #fff;
            border: 1px solid #e5e8eb;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .flow-box.primary {
            background: #eff8ff;
            border-color: #3182f6;
            color: #3182f6;
        }

        .flow-box.warning {
            background: #fff7ed;
            border-color: #f59e0b;
            color: #f59e0b;
        }

        .flow-box.success {
            background: #ecfdf5;
            border-color: #10b981;
            color: #10b981;
        }

        .flow-arrow {
            font-size: 20px;
            color: #8b95a1;
        }

        .checklist {
            list-style: none;
            margin-left: 0;
        }

        .checklist li {
            padding: 8px 0;
            padding-left: 28px;
            position: relative;
        }

        .checklist li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 10px;
            width: 16px;
            height: 16px;
            border: 2px solid #e5e8eb;
            border-radius: 4px;
        }

        .checklist li.done::before {
            background: #10b981;
            border-color: #10b981;
        }

        .checklist li.done::after {
            content: '✓';
            position: absolute;
            left: 3px;
            top: 8px;
            color: #fff;
            font-size: 12px;
            font-weight: bold;
        }

        .code-table {
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
        }

        .code-table td:first-child {
            background: #f9fafb;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px;
            }

            .info-box {
                grid-template-columns: 1fr;
            }

            .flow-row {
                flex-direction: column;
            }

            .flow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="document-header">
        <div class="logo-container">
            <img src="https://nofee.team/images/logo.svg" alt="NOFEE" class="logo">
            <div class="doc-meta">
                <div class="doc-meta-item">작성일: 2025.12.13</div>
                <div class="doc-meta-item">버전: v1.0</div>
                <div class="doc-meta-item">작성자: 제이콥</div>
            </div>
        </div>
        <h1 class="doc-title">Deal 페이지 가격 API 개선</h1>
        <p class="doc-subtitle">외부 API 의존성 제거로 Deal 페이지 "가격 구성" 섹션 안정화</p>
    </div>

    <div class="info-box">
        <div class="info-item">
            <div class="info-label">문서 유형</div>
            <div class="info-value">기획안</div>
        </div>
        <div class="info-item">
            <div class="info-label">우선순위</div>
            <div class="info-value">높음 (High)</div>
        </div>
        <div class="info-item">
            <div class="info-label">진행 상태</div>
            <div class="info-value">백엔드 스케줄러 완료</div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">개요</h2>
        <div class="content">
            <p>Deal 페이지 "가격 구성" 섹션이 외부 서버(Subapi) 장애 시 표시되지 않는 문제를 해결합니다.</p>

            <div class="highlight-box">
                <strong>핵심 변경사항</strong><br>
                • 외부 Subapi 의존성 제거<br>
                • 스케줄러 기반 데이터 수집 (1시간마다)<br>
                • 내부 DB에서 모든 가격 정보 조회
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">현재 문제점</h2>
        <div class="content">
            <h3 class="subsection-title">AS-IS 데이터 흐름</h3>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box">Deal 페이지</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box success">내부 DB (안정적)</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box">할부원금, 월납부금, 요금제</div>
                </div>
                <div class="flow-row">
                    <div class="flow-box">Deal 페이지</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box warning">외부 Subapi (불안정)</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box">출고가, 공시지원금, 추가지원금</div>
                </div>
            </div>

            <div class="highlight-box warning">
                <strong>문제</strong>: 외부 Subapi 장애 시 "가격 구성" 섹션 표시 불가
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">해결 방안</h2>
        <div class="content">
            <h3 class="subsection-title">TO-BE 데이터 흐름</h3>

            <p><strong>1단계: 스케줄러가 통신사 데이터 수집 (1시간마다)</strong></p>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box">통신사 서버<br><small>SKT, KT, LGU+</small></div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box primary">스케줄러<br><small>1시간 간격 자동 수집</small></div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box success">내부 DB<br><small>tb_public_subsidy, tb_product_phone</small></div>
                </div>
            </div>

            <p><strong>2단계: Deal 페이지에서 내부 DB 조회</strong></p>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box">Deal 페이지</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box success">내부 DB (안정적)</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box">모든 데이터</div>
                </div>
            </div>

            <div class="highlight-box success">
                <strong>해결</strong>: 스케줄러가 미리 수집한 데이터를 내부 DB에서 조회 → 안정적 서비스
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">신규 테이블 구조</h2>
        <div class="content">
            <h3 class="subsection-title">tb_carrier_rate_plan (통신사 요금제)</h3>
            <p>스케줄러가 통신사에서 수집한 요금제 정보</p>
            <table class="comparison-table code-table">
                <thead>
                    <tr>
                        <th>컬럼</th>
                        <th>설명</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>plan_code</td>
                        <td>통신사 요금제 코드</td>
                    </tr>
                    <tr>
                        <td>carrier_code</td>
                        <td>통신사 코드</td>
                    </tr>
                    <tr>
                        <td>rate_plan_code</td>
                        <td>노피 요금제 코드 (매핑)</td>
                    </tr>
                    <tr>
                        <td>plan_nm</td>
                        <td>요금제명</td>
                    </tr>
                    <tr>
                        <td>month_fee</td>
                        <td>월정액</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="subsection-title">tb_public_subsidy (공시지원금)</h3>
            <p>스케줄러가 통신사에서 수집한 공시지원금 정보</p>
            <table class="comparison-table code-table">
                <thead>
                    <tr>
                        <th>컬럼</th>
                        <th>설명</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>carrier_code</td>
                        <td>통신사 코드</td>
                    </tr>
                    <tr>
                        <td>product_code</td>
                        <td>상품 코드</td>
                    </tr>
                    <tr>
                        <td>rate_plan_code</td>
                        <td>요금제 코드</td>
                    </tr>
                    <tr>
                        <td>join_type_code</td>
                        <td>가입유형 코드</td>
                    </tr>
                    <tr>
                        <td>public_subsidy</td>
                        <td>공시지원금</td>
                    </tr>
                    <tr>
                        <td>additional_subsidy</td>
                        <td>추가지원금 (공시지원금의 15%)</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="subsection-title">tb_product_phone (출고가 추가)</h3>
            <p>기존 테이블에 통신사별 출고가 컬럼 추가</p>
            <table class="comparison-table code-table">
                <thead>
                    <tr>
                        <th>컬럼</th>
                        <th>설명</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>sk_release_price</td>
                        <td>SKT 출고가</td>
                    </tr>
                    <tr>
                        <td>kt_release_price</td>
                        <td>KT 출고가</td>
                    </tr>
                    <tr>
                        <td>lg_release_price</td>
                        <td>LGU+ 출고가</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">현재 데이터 현황 (개발 서버)</h2>
        <div class="content">
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>테이블</th>
                        <th>SKT</th>
                        <th>KT</th>
                        <th>LGU+</th>
                        <th>총</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>tb_carrier_rate_plan</td>
                        <td>70건</td>
                        <td>92건</td>
                        <td>96건</td>
                        <td>258건</td>
                    </tr>
                    <tr>
                        <td>tb_public_subsidy</td>
                        <td>462건</td>
                        <td>864건</td>
                        <td>1,152건</td>
                        <td>2,478건</td>
                    </tr>
                    <tr>
                        <td>tb_product_phone (출고가)</td>
                        <td>85건</td>
                        <td>88건</td>
                        <td>77건</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>
            <p style="font-size: 12px; color: #8b95a1; margin-top: 8px;">최근 동기화: 2025-12-13 00:03:34 (1시간마다 실행)</p>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">Deal 페이지 UI 매핑</h2>
        <div class="content">
            <h3 class="subsection-title">가격 구성 섹션</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>UI 항목</th>
                        <th>데이터 소스</th>
                        <th>조회 방법</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>① 출고가</td>
                        <td>tb_product_phone</td>
                        <td>carrier_code에 따라 sk/kt/lg_release_price</td>
                    </tr>
                    <tr>
                        <td>② 공시지원금</td>
                        <td>tb_public_subsidy</td>
                        <td>product_code + carrier_code + rate_plan_code + join_type_code</td>
                    </tr>
                    <tr>
                        <td>③ 추가지원금</td>
                        <td>tb_public_subsidy</td>
                        <td>위와 동일</td>
                    </tr>
                    <tr>
                        <td>④ 판매점 할인</td>
                        <td>계산</td>
                        <td>출고가 - 공시지원금 - 추가지원금 - 실구매가</td>
                    </tr>
                    <tr>
                        <td>⑤ 실 구매가</td>
                        <td>tb_pricetable_store_phone_row</td>
                        <td>기존과 동일</td>
                    </tr>
                    <tr>
                        <td>⑥ 월요금 평균납부액</td>
                        <td>tb_pricetable_store_phone_row</td>
                        <td>monthPrice (기존 필드)</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">에이전시 어드민 입력 항목</h2>
        <div class="content">
            <p>판매점이 시세표 업로드 시 입력:</p>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>구분</th>
                        <th>항목</th>
                        <th>설명</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>공통</td>
                        <td>할부원금</td>
                        <td>판매점에서 제시하는 실제 할부원금</td>
                    </tr>
                    <tr>
                        <td>공시지원금</td>
                        <td>요금제 유지기간</td>
                        <td>공시지원금 개통 시 요금제 유지해야 하는 기간 (개월)</td>
                    </tr>
                    <tr>
                        <td>공시지원금</td>
                        <td>변경가능 요금제</td>
                        <td>유지기간 후 변경 가능한 최소 요금제</td>
                    </tr>
                    <tr>
                        <td>선택약정</td>
                        <td>요금제 유지기간</td>
                        <td>선택약정 개통 시 요금제 유지해야 하는 기간 (개월)</td>
                    </tr>
                    <tr>
                        <td>선택약정</td>
                        <td>변경가능 요금제</td>
                        <td>유지기간 후 변경 가능한 최소 요금제</td>
                    </tr>
                </tbody>
            </table>
            <div class="highlight-box">
                <strong>참고</strong>: 판매점마다 요금제 조건이 다를 수 있으므로, 각 판매점이 직접 입력한 값을 사용
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">작업 체크리스트</h2>
        <div class="content">
            <h3 class="subsection-title">백엔드 - 스케줄러 (완료)</h3>
            <ul class="checklist">
                <li class="done">tb_carrier_rate_plan 테이블 생성</li>
                <li class="done">tb_public_subsidy 테이블 생성</li>
                <li class="done">tb_product_phone에 출고가 컬럼 추가</li>
                <li class="done">1시간마다 통신사 데이터 수집 스케줄러 구현</li>
            </ul>

            <h3 class="subsection-title">백엔드 - API (진행 예정)</h3>
            <ul class="checklist">
                <li>Deal 페이지 API에서 tb_public_subsidy, tb_product_phone JOIN하여 조회</li>
                <li>API 응답에 releasePrice, publicSubsidy, additionalSubsidy 필드 추가 (monthPrice는 기존 필드 활용)</li>
            </ul>

            <h3 class="subsection-title">프론트엔드</h3>
            <ul class="checklist">
                <li>Deal 페이지에서 내부 DB 데이터 사용하도록 변경</li>
                <li>외부 Subapi 호출 코드 제거</li>
            </ul>

            <h3 class="subsection-title">운영 배포</h3>
            <ul class="checklist">
                <li>운영 서버에 tb_carrier_rate_plan, tb_public_subsidy 테이블 생성</li>
                <li>운영 서버 스케줄러 배포</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">참고: 공통 코드</h2>
        <div class="content">
            <h3 class="subsection-title">통신사</h3>
            <table class="comparison-table code-table">
                <thead>
                    <tr>
                        <th>코드</th>
                        <th>값</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>0301001001</td>
                        <td>SKT</td>
                    </tr>
                    <tr>
                        <td>0301001002</td>
                        <td>KT</td>
                    </tr>
                    <tr>
                        <td>0301001003</td>
                        <td>LGU+</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="subsection-title">가입유형</h3>
            <table class="comparison-table code-table">
                <thead>
                    <tr>
                        <th>코드</th>
                        <th>값</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>0301007001</td>
                        <td>신규가입</td>
                    </tr>
                    <tr>
                        <td>0301007002</td>
                        <td>번호이동</td>
                    </tr>
                    <tr>
                        <td>0301007003</td>
                        <td>기기변경</td>
                    </tr>
                </tbody>
            </table>

            <h3 class="subsection-title">지원유형</h3>
            <table class="comparison-table code-table">
                <thead>
                    <tr>
                        <th>코드</th>
                        <th>값</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>0301006001</td>
                        <td>공시지원금</td>
                    </tr>
                    <tr>
                        <td>0301006002</td>
                        <td>선택약정</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
