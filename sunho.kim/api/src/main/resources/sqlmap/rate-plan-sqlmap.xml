<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nofee.api.test.carrierintegration.mapper.NofeeRatePlanMapper">

    <!-- 통신사별 요금제 목록 조회 -->
    <select id="selectRatePlansByCarrier" parameterType="String" resultType="com.nofee.api.test.carrierintegration.dto.NofeeRatePlan">
        /* [rate-plan-sqlmap][selectRatePlansByCarrier] 통신사별 요금제 조회 */
        SELECT
            rate_plan_code as ratePlanCode,
            rate_plan_nm as ratePlanNm,
            description,
            carrier_code as carrierCode,
            month_fee as monthFee
        FROM
            tb_rate_plan_phone
        WHERE
            deleted_yn = 'N'
            <if test="carrierCode != null and carrierCode != ''">
                AND carrier_code = #{carrierCode}
            </if>
        ORDER BY carrier_code, month_fee ASC
    </select>

    <!-- 전체 요금제 목록 조회 -->
    <select id="selectAllRatePlans" resultType="com.nofee.api.test.carrierintegration.dto.NofeeRatePlan">
        /* [rate-plan-sqlmap][selectAllRatePlans] 전체 요금제 조회 */
        SELECT
            rate_plan_code as ratePlanCode,
            rate_plan_nm as ratePlanNm,
            description,
            carrier_code as carrierCode,
            month_fee as monthFee
        FROM
            tb_rate_plan_phone
        WHERE
            deleted_yn = 'N'
        ORDER BY carrier_code, month_fee ASC
    </select>

    <!-- 판매중인 상품의 요금제 금액 목록 (중복 제거) -->
    <select id="selectDistinctMonthlyFees" resultType="com.nofee.api.test.carrierintegration.dto.NofeeRatePlanSummary">
        /* [rate-plan-sqlmap][selectDistinctMonthlyFees] 판매중인 요금제 금액 목록 */
        SELECT DISTINCT
            carrier_code as carrierCode,
            month_fee as monthFee
        FROM
            tb_rate_plan_phone
        WHERE
            deleted_yn = 'N'
            AND month_fee IS NOT NULL
            AND month_fee > 0
        ORDER BY carrier_code, month_fee ASC
    </select>

    <!-- 통신사 기본 정책 조회 -->
    <select id="selectCarrierPlanPolicy" resultType="com.nofee.api.test.carrierintegration.dto.CarrierPlanPolicy">
        /* [rate-plan-sqlmap][selectCarrierPlanPolicy] 통신사 기본 정책 조회 */
        SELECT
            carrier_code as carrierCode,
            min_month_fee as minMonthFee,
            basic_month_fee as basicMonthFee,
            public_support_days as publicSupportDays,
            optional_contract_days as optionalContractDays,
            optional_discount_rate as optionalDiscountRate
        FROM
            tb_carrier_plan_phone
        WHERE
            deleted_yn = 'N'
        ORDER BY carrier_code
    </select>
</mapper>
