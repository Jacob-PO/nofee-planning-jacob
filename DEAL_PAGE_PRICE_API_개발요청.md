# Deal 페이지 가격 API 개선

## 목표

> **외부 API 의존성 제거**
>
> Deal 페이지 "가격 구성" 섹션이 외부 서버(Subapi) 장애 시 표시 안 되는 문제 해결

---

## 현재 문제점

### AS-IS 데이터 흐름

| Deal 페이지 | → | 내부 DB (안정적) | → | 할부원금, 월납부금, 요금제 |
| --- | --- | --- | --- | --- |
| Deal 페이지 | → | **외부 Subapi (불안정) ⚠️** | → | **출고가, 공시지원금, 추가지원금** |

> ⚠️ **문제**: 외부 Subapi 장애 시 "가격 구성" 섹션 표시 불가

---

## 해결 방안

### TO-BE 데이터 흐름

| Deal 페이지 | → | 내부 DB (안정적) ✅ | → | 모든 데이터 |
| --- | --- | --- | --- | --- |

> ✅ **해결**: 모든 데이터를 내부 DB에서 조회 → 안정적 서비스

---

## Deal 페이지 UI 구성

### 1. 가격 구성 섹션 ← 이번 작업 대상

| UI 항목 | 예시 값 | 현재 | 변경 후 |
| --- | --- | --- | --- |
| ① 출고가 | 899,000원 | 외부 API | **내부 DB** ✅ |
| ② 공시지원금 | -360,000원 | 외부 API | **내부 DB** ✅ |
| ③ 추가지원금 | -54,000원 | 외부 API | **내부 DB** ✅ |
| ④ 판매점 할인 | -95,000원 | 자동 계산 | 자동 계산 (유지) |
| ⑤ 실 구매가 | 390,000원 | 내부 DB | 내부 DB (유지) |

**판매점 할인 계산식**

> 판매점 할인 = 출고가 - 공시지원금 - 추가지원금 - 실구매가

### 2. 월 납부금 섹션 ← 변경 없음

| UI 항목 | 예시 값 | 소스 |
| --- | --- | --- |
| 실 구매가 | 390,000원 | 내부 DB |
| 할부 기간 | 24개월 | 고정값 |
| 요금제 (6개월 유지) | 110,000원 | 내부 DB |

> ✅ 이미 내부 DB 데이터 사용 중 → 변경 불필요

### 3. 조건 상세 섹션 ← 변경 없음

| UI 항목 | 예시 값 | 소스 |
| --- | --- | --- |
| 개통 통신사 | KT | 내부 DB |
| 가입 유형 | 번호이동 | 내부 DB |
| 지원 유형 | 공시지원금 | 내부 DB |
| 요금제 | 110,000원 | 내부 DB |
| 요금제 유지 기간 | 6개월 | 내부 DB |
| 변경 가능 최소 요금제 | 49,000원 | 내부 DB |

> ✅ 이미 내부 DB 데이터 사용 중 → 변경 불필요

---

## 데이터 변경 요약

### 추가할 데이터 (DB)

| 데이터 | 설명 | 예시 값 |
| --- | --- | --- |
| 출고가 | 휴대폰 정가 | 899,000원 |
| 공시지원금 | 통신사 기기 할인 | 360,000원 |
| 추가지원금 | 통신사 추가 할인 | 54,000원 |

> 💡 **참고**: 출고가 컬럼은 이미 존재하나 값이 비어있음. 값만 채우면 됨.

### API 응답에 추가할 필드

| 필드명 | 설명 |
| --- | --- |
| releasePrice | 출고가 (기존 필드, 값 채움) |
| totalSupportFee | 공시지원금 (신규) |
| additionalSupportFee | 추가지원금 (신규) |

---

## 에이전시 어드민 입력 항목

판매점이 시세표 업로드 시 입력:

| 구분 | 항목 | 설명 |
| --- | --- | --- |
| 공통 | 할부원금 | 판매점에서 제시하는 실제 할부원금 |
| 공시지원금 | 요금제 유지기간 | 공시지원금 개통 시 요금제 유지해야 하는 기간 (개월) |
| 공시지원금 | 변경가능 요금제 | 유지기간 후 변경 가능한 최소 요금제 |
| 선택약정 | 요금제 유지기간 | 선택약정 개통 시 요금제 유지해야 하는 기간 (개월) |
| 선택약정 | 변경가능 요금제 | 유지기간 후 변경 가능한 최소 요금제 |

> 💡 **참고**: 판매점마다 요금제 조건이 다를 수 있으므로, 각 판매점이 직접 입력한 값을 사용

---

## 작업 체크리스트

### 백엔드

- [ ] DB에 공시지원금, 추가지원금 컬럼 추가
- [ ] 출고가, 공시지원금, 추가지원금 데이터 입력 (SQL)
- [ ] API 응답에 새 필드 추가

### 프론트엔드

- [ ] Deal 페이지에서 내부 DB 데이터 사용하도록 변경
- [ ] 외부 API 호출 코드 제거

---

## 참고: 공통 코드

### 통신사

| 코드 | 값 |
| --- | --- |
| 0301001001 | SKT |
| 0301001002 | KT |
| 0301001003 | LGU+ |

### 가입유형

| 코드 | 값 |
| --- | --- |
| 0301007001 | 신규가입 |
| 0301007002 | 번호이동 |
| 0301007003 | 기기변경 |

### 지원유형

| 코드 | 값 |
| --- | --- |
| 0301006001 | 공시지원금 |
| 0301006002 | 선택약정 |
